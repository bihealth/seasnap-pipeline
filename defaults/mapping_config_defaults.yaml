#---------------------------------------- general pipeline parameters
pipeline_param:
  # adjust pattern of stored files
  out_path_pattern: mapping/{step}/{sample}.{mate}/out/{step}.{sample}.{mate}.{extension}
  log_path_pattern: mapping/{step}/{sample}.{mate}/report/{step}.{sample}.{mate}.{extension}
  in_path_pattern: ../input/{sample}/{sample}.{mate}
  
  # adjust which files to produce
  mapping_results:
    - "salmon-transcript_counts"
    - "star-gene_counts"
  QC_results:
    - "fastqc"
    - "dupradar"
    - "infer_experiment"

#---------------------------------------- organism annotation
organism_defaults: null

#---------------------------------------- parameters for rules
rule_options:
  star: 
    cmd_opt: "--outSAMunmapped Within --outFilterType BySJout --outFilterMultimapNmax 20 --alignSJoverhangMin 8 --alignSJDBoverhangMin 1 --outFilterMismatchNmax 999 --outFilterMismatchNoverLmax 0.04 --alignIntronMin 20 --alignIntronMax 1000000 --alignMatesGapMax 1000000 --genomeLoad NoSharedMemory --outSAMattributes NH HI AS NM MD --outSAMtype BAM Unsorted"
    trim: yes
  star_index: 
    cmd_opt: "--sjdbOverhang 49" # optimally sjdbOverhang = <read_length> - 1
  salmon_index:
    cmd_opt: "-k 31"             # (k the default k-mer size of 31 is suitable for read length around 75)
  salmon: 
    cmd_opt: ""
    trim: yes

#---------------------------------------- parameters for the report
report:
  multiqc:
    title: SeA-SnaP mapping pipeline QC report
    subtitle: run at the BIH CUBI
    intro_text: The reports summarises results of several analyses
    custom_logo: pictures/SeA-SnaP_logo.png
    sp:
      fastqc/zip:
        fn: 'fastqc.*.zip'
        
#---------------------------------------- configuration for export
export:
  path_pattern:
    - SODAR_export/{sample}/{GENOME}/%Y_%m_%d/{files:ngs_mapping:out}/{step}/out/{step}.{sample}.{extension}
    - SODAR_export/{sample}/{GENOME}/%Y_%m_%d/{files:ngs_mapping:rep}/{step}/report/
    - SODAR_export/{sample}/{GENOME}/%Y_%m_%d/{files:gene_expression_quantification}/{step}/out/{step}.{sample}.{extension}
  ngs_mapping_out:
    - {step: star, extension: bam}
  ngs_mapping_rep:
    - dir: {step: star, log: true}
  gene_expression_quantification:
    - {step: star, extension: gene_counts.tab}
    - {step: salmon, extension: sf}
